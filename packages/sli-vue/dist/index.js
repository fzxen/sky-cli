"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=require("commander"),o=e(require("ora")),n=require("webpack"),s=e(n),t=e(require("webpack-dev-server")),i=e(require("webpack-chain")),a=e(require("webpack-merge")),l=e(require("path")),u=e(require("fs")),c=e(require("mini-css-extract-plugin")),p=require("clean-webpack-plugin"),d=e(require("optimize-css-assets-webpack-plugin")),v=require("vue-loader"),m=require("webpack-bundle-analyzer"),f=e(require("html-webpack-plugin")),h=e(require("cssnano")),g=e(require("terser-webpack-plugin")),b=e(require("chalk")),y=function(){return(y=Object.assign||function(e){for(var r,o=1,n=arguments.length;o<n;o++)for(var s in r=arguments[o])Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s]);return e}).apply(this,arguments)};function q(){for(var e=0,r=0,o=arguments.length;r<o;r++)e+=arguments[r].length;var n=Array(e),s=0;for(r=0;r<o;r++)for(var t=arguments[r],i=0,a=t.length;i<a;i++,s++)n[s]=t[i];return n}var w=function(e){return l.resolve(process.cwd(),""+e)},k=function(e,r,o){var n={},s=function(){var e,r={},o=u.readFileSync(w("./package.json")).toString(),n=JSON.parse(o).dependencies;for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=null===(e=/\d+\.\d+\.\d+$/g.exec(n[s]))||void 0===e?void 0:e[0]);return r}(),t=e.map((function(e){if(e.name in s){var t=s[e.name];return n[e.name]=e.scope,{css:e.css&&[r,e.alias||e.name,t,e.css[o]].join("/"),js:e.js&&[r,e.alias||e.name,t,e.js[o]].join("/")}}throw new Error("相关依赖未安装，请先执行npm install "+e.name)}));return{externals:n,htmlCdns:t}},j=require("os").cpus().length>1,O={loader:require.resolve("eslint-loader"),options:{fix:!0}},x=function(e,r){var o,n={test:/\.(js)$/,use:[j?require.resolve("thread-loader"):"",{loader:require.resolve("babel-loader"),options:{cacheDirectory:!0,sourceType:"unambiguous"}}].filter((function(e){return e})),include:[/src/]},s=[O];return"development"===e&&!1!==r&&(o=n.use).push.apply(o,s),n},P=function(e,r){var o,n={test:/\.vue$/,use:[j?require.resolve("thread-loader"):"",require.resolve("vue-loader")].filter((function(e){return e})),include:[/src/]},s=[O];return"development"===e&&!1!==r&&(o=n.use).push.apply(o,s),n},S=function(e,r){var o={test:/\.css$/,oneOf:[{use:["production"===e?c.loader:require.resolve("vue-style-loader"),require.resolve("css-loader"),require.resolve("postcss-loader")]}]};return r&&o.oneOf.unshift({resourceQuery:/module/,use:["production"===e?c.loader:require.resolve("vue-style-loader"),{loader:require.resolve("css-loader"),options:{modules:!0}},require.resolve("postcss-loader")]}),o},C=function(e,r){var o={test:/\.less$/,use:["production"===e?c.loader:require.resolve("vue-style-loader"),require.resolve("css-loader"),require.resolve("postcss-loader"),{loader:require.resolve("less-loader"),options:{javascriptEnabled:!0}}]};return r&&r.length>0&&o.use.push({loader:require.resolve("sass-resources-loader"),options:{resources:r}}),o},$=function(e,r){var o={test:/\.s(a|c)ss$/,use:["production"===e?c.loader:require.resolve("vue-style-loader"),require.resolve("css-loader"),require.resolve("postcss-loader"),require.resolve("sass-loader")]};return r&&r.length>0&&o.use.push({loader:require.resolve("sass-resources-loader"),options:{resources:r}}),o},z=function(e){var r="production"===e?"[name][contenthash:8].[ext]":"[name].[ext]";return[{test:/\.(jpg|png|gif|jpeg|svg)$/i,use:[{loader:require.resolve("url-loader"),options:{limit:3072,name:"assets/images/"+r}}]},{test:/\.(woff2|woff|eot|ttf|otf)$/i,loader:require.resolve("url-loader"),options:{name:"assets/fonts/"+r}},{test:/\.(mp4|avi|mp3|rmvb|wmv|flv)$/i,loader:require.resolve("url-loader"),options:{name:"assets/media/"+r}},{test:/\.(pdf|doc|docx|ppt|xls|xlsx)$/i,loader:require.resolve("url-loader"),options:{name:"assets/files/"+r}}]},E=function(e){var r;return"development"===e&&(r=new n.HotModuleReplacementPlugin),r},D=function(e){var r;return"production"===e&&(r=new c({filename:"assets/style/[name][contenthash:8].css"})),r},W=function(e){var r;return"production"===e&&(r=new p.CleanWebpackPlugin),r},N=function(e){var r;return"production"===e&&(r=new d({assetNameRegExp:/\.css$/,cssProcessor:h,cssProcessorPluginOptions:{preset:["default",{discardComments:{removeAll:!0}}]}})),r},A=function(e,r,o,n){void 0===o&&(o="./public/index.html"),void 0===n&&(n="./public/favicon.ico");var s={template:w(o),favicon:w(n),cdnConfig:r,inject:!r};return"production"===e&&(s=y(y({},s),{minify:{caseSensitive:!1,collapseWhitespace:!0,removeAttributeQuotes:!0,removeComments:!0}})),new f(s)};function T(e,r){var o,n,s=r.analysis,t=r.css,i=r.cdn,a=r.eslintCompileCheck,l=t.loaderOption,u={},c=[];if(i){var p=k(i.sources,i.origin,e);u=p.externals,c=p.htmlCdns}return{entry:{main:"./src/main.js"},module:{rules:q([S(e,t.module)],z(e),[$(e,null===(o=l.scss)||void 0===o?void 0:o.prependData),P(e,a),x(e,a),C(e,null===(n=l.less)||void 0===n?void 0:n.prependData)])},plugins:[s?new m.BundleAnalyzerPlugin({analyzerPort:"auto"}):null,A(e,c),W(e),E(e),D(e),N(e),new v.VueLoaderPlugin].filter((function(e){return e})),externals:u}}var _=function(e,r){return"development"===e?function(e,r){var o=T(e,r);return a(o,{output:{publicPath:"/",filename:"assets/[name].js",path:w("./dist")},mode:e,devtool:"cheap-module-eval-source-map",devServer:{hot:!0,inline:!0,open:!0,stats:"errors-warnings",compress:!0,historyApiFallback:!0,overlay:{errors:!0,warnings:!1}}})}(e,r):function(e,r){var o=T(e,r);return a(o,{output:{publicPath:"/",filename:"assets/[name][chunkhash:8].js",path:w("./dist")},mode:e,optimization:{minimize:!0,minimizer:[new g({cache:!0,parallel:!0,extractComments:!0,terserOptions:{compress:{unused:!0,drop_debugger:!0,drop_console:!0,dead_code:!0}}})],splitChunks:{chunks:"all",minSize:3e4,maxSize:0,minChunks:1,maxAsyncRequests:5,maxInitialRequests:3,automaticNameDelimiter:"~",name:!0,cacheGroups:{vendors:{test:/[\\/]node_modules[\\/]/,priority:-10},default:{minChunks:2,priority:-20,reuseExistingChunk:!0}}}}})}(e,r)},R={cdn:!1,configureWebpack:{},chainWebpack:function(e){},devServer:{},css:{module:!1,loaderOption:{scss:{prependData:[]},less:{prependData:[]}}},analysis:!1},V=function(e,r){return o=require(process.cwd()+"/sli.config.js"),n=a(R,o),s=n.configureWebpack,t=n.chainWebpack,l=n.devServer,u=function(e,r){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)r.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o}(n,["configureWebpack","chainWebpack","devServer"]),c=new i,t(c),r.port&&(l.port=r.port),r.analysis&&(u.analysis=r.analysis),a(_(e,u),s,c.toConfig(),{devServer:l});var o,n,s,t,l,u,c},F=new r.Command;F.command("dev").description("run your app in development").alias("d").option("-p, --port <port>","Port used by the server (default: 8080)").action((function(e){!function(e){var r,n,i=o();i.start("app is starting..."),process.env.NODE_ENV="development";var a=V("development",{port:e}),l=s(a);e=(null===(r=a.devServer)||void 0===r?void 0:r.port)||8080;var u=(null===(n=a.devServer)||void 0===n?void 0:n.host)||"localhost";l.hooks.done.tap("buildTip",(function(){i.succeed("compile successfully!\n      please open  http://"+u+":"+e)})),l.hooks.failed.tap("buildTip",(function(e){i.fail("compile failed"),console.log(e)})),new t(l,a.devServer||{}).listen(e,u)}(e.port)})),F.command("build").description("build your app (production)").alias("b").option("-a, --analysis","show buldle information").action((function(e){!function(e){var r=o();r.start("app is building..."),process.env.NODE_ENV="production";var n=V("production",{analysis:e}),t=s(n);t.hooks.done.tap("buildTip",(function(){r.succeed("build successfully!")})),t.hooks.failed.tap("buildTip",(function(e){r.fail("build failed"),console.log(e)})),t.run((function(e,r){var o=r.toJson();console.log([b.green("Time: "+o.time+"ms"),b.green("webpack version: "+o.version)].join("\n"))}))}(e.analysis)})),F.version(require("../package.json").version,"-v --version").parse(process.argv),process.argv.slice(2).length||F.outputHelp();
